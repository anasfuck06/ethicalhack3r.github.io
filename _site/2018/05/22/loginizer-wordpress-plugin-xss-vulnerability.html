<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title> Security Vulnerability in Loginizer WordPress Plugin </title>
    <meta name="description" content="Versions 1.3.8 to 1.3.9 of the Loginizer WordPress Plugin were found to be vulnerable to Stored Cross-Site Scripting (XSS). The vulnerability was due to the ...">

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />
    <!-- This is for syntax highlight -->
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css">
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-60x60.png" />
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://dewhurstsecurity.com/img/favicomatic/img/favicomatic/apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-152x152.png" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-196x196.png" sizes="196x196" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-32x32.png" sizes="32x32" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-16x16.png" sizes="16x16" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-128.png" sizes="128x128" />
	<meta name="application-name" content="&nbsp;"/>
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="https://dewhurstsecurity.com/img/favicomatic/mstile-144x144.png" />
	<meta name="msapplication-square70x70logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-70x70.png" />
	<meta name="msapplication-square150x150logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-150x150.png" />
	<meta name="msapplication-wide310x150logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-310x150.png" />
	<meta name="msapplication-square310x310logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-310x310.png" />

</head>
<body class="home-template">


    <main class="content" role="main">

    <article class="post">
        <header class="post-header">
            <a id="blog-logo" href="https://blog.dewhurstsecurity.com">
                
                    <span class="blog-title">Dewhurst Security Blog</span>
                
            </a>
        </header>

        <span class="post-meta">
        	<time datetime="2018-05-22">22 May 2018</time>
        	
        		on
	        	
	        
       	</span>

        <h1 class="post-title">Security Vulnerability in Loginizer WordPress Plugin</h1>

        <section class="post-content">
            <h3 id="introduction">Introduction</h3>

<p>According to Loginizer’s WordPress Plugin page: “Loginizer is a WordPress plugin which helps you fight against bruteforce attack by blocking login for the IP after it reaches maximum retries allowed. You can blacklist or whitelist IPs for login using Loginizer. You can use various other features like Two Factor Auth, reCAPTCHA, PasswordLess Login, etc. to improve security of your website.”</p>

<p>According to WordPress, at the time of writing the Plugin had <code class="highlighter-rouge">700,000+</code> active installations. The vulnerability discovered could allow an unauthenticated attacker to compromise a WordPress blog if the administrative user views the Loginizer log file.</p>

<p>This issue was patched within hours by the vendor in version 1.4.0.</p>

<h3 id="description">Description</h3>

<p>Versions 1.3.8 to 1.3.9 the Loginizer WordPress Plugin were found to be vulnerable to Stored Cross-Site Scripting (XSS). The vulnerability was due to the Plugin’s logging functionality using the <code class="highlighter-rouge">$_SERVER['REQUEST_URI']</code> PHP variable to create a URL string that was logged to the database without any input validation. The URL that was saved to the database was later output within HTML without any output encoding.</p>

<h3 id="risk">Risk</h3>

<p>An unauthenticated attacker could inject malicious JavaScript into the <code class="highlighter-rouge">Loginizer - Brute Force Settings</code> page where attempted brute force logs are displayed. When an administrative user visits the page, the JavaScript would be executed, which could allow an unauthenticated attacker to entirely compromise the WordPress application.</p>

<h3 id="affected-software">Affected Software</h3>

<p>Loginizer 1.3.8-1.3.9 - <a href="https://wordpress.org/plugins/loginizer/">https://wordpress.org/plugins/loginizer/</a></p>

<h3 id="technical-description">Technical Description</h3>

<p>Source: On line 577 of the <code class="highlighter-rouge">init.php</code> file, the <code class="highlighter-rouge">$_SERVER['REQUEST_URI']</code> variable is placed within the <code class="highlighter-rouge">$url</code> variable along with other information, and then saved to the database without any validation:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$url = @addslashes((!empty($_SERVER['HTTPS']) ? 'https://' : 'http://').$_SERVER['HTTP_HOST'].$_SERVER['REQUEST_URI']);
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$sresult = $wpdb-&gt;query("UPDATE `".$wpdb-&gt;prefix."loginizer_logs` SET `username` = '".$username."', `time` = '".time()."', `count` = `count`+1, `lockout` = '".$lockout."', `url` = '".$url."' WHERE `ip` = '".$loginizer['current_ip']."';");
</code></pre></div></div>

<p>Sink: On line 1684 of the <code class="highlighter-rouge">init.php</code> file, the <code class="highlighter-rouge">$iv['url']</code> variable, containing the unvalidated URL from the database is output within HTML without any output encoding:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;td&gt;
  '.$iv['url'].'
&lt;/td&gt;
</code></pre></div></div>

<h3 id="proof-of-concept-poc">Proof of Concept (PoC)</h3>

<p>The following cURL request will inject a PoC XSS payload, which will be triggered when viewing the Brute Force settings page:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl --data "log=admin&amp;pwd=admin&amp;wp-submit=Log+In&amp;redirect_to=&amp;testcookie=1" "http://www.example.com/wp-login.php?a=&lt;script&gt;alert(/XSS/)&lt;/script&gt;" 
</code></pre></div></div>

<p>A fully weaponised XSS exploit was created that used the WordPress Theme Editor to insert a PHP backdoor into a WordPress site. The weaponised XSS payload has not been supplied with this advisory, however, it is trivial to create.</p>

<h3 id="remediation">Remediation</h3>

<p>Vendor: Pass the <code class="highlighter-rouge">$url</code> variable through WordPress’ <code class="highlighter-rouge">esc_url()</code> function. For example: <code class="highlighter-rouge">$url = esc_url($url);</code></p>

<p>Users: Update to version 1.4.0, which fixes the vulnerability.</p>

<h3 id="timeline">Timeline</h3>

<ul>
  <li>21/05/2018 01:36: Issue discovered by Leigh (Dewhurst Security).</li>
  <li>21/05/2018 11:00: Issue verified by Ryan (Dewhurst Security).</li>
  <li>21/05/2018 11:50: Vendor notified.</li>
  <li>21/05/2018 17:00: Vendor replies to ticket and releases a patched version, version 1.4.0.</li>
  <li>22/05/2018 19:30: Advisory publicly released.</li>
</ul>

<h3 id="references">References</h3>

<ul>
  <li><a href="https://codex.wordpress.org/Function_Reference/esc_url">https://codex.wordpress.org/Function_Reference/esc_url</a></li>
  <li><a href="https://www.wordfence.com/learn/how-to-prevent-cross-site-scripting-attacks/">https://www.wordfence.com/learn/how-to-prevent-cross-site-scripting-attacks/</a></li>
  <li><a href="http://www.loginizer.com/">http://www.loginizer.com/</a></li>
  <li><a href="https://plugins.trac.wordpress.org/changeset/1878502/loginizer">https://plugins.trac.wordpress.org/changeset/1878502/loginizer</a></li>
  <li><a href="https://wpvulndb.com/vulnerabilities/9088">https://wpvulndb.com/vulnerabilities/9088</a></li>
</ul>

        </section>

        

        <footer class="post-footer">
            <section class="hire-me">
              <h4><a href="https://dewhurstsecurity.com/" onClick="_gaq.push(['_trackEvent', 'External Link', 'Dewhurst Security Link', 'Hire Us – Words']);">Hire Us</a></h4>
            </section>

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Security Vulnerability in Loginizer WordPress Plugin&amp;url=https://blog.dewhurstsecurity.com/2018/05/22/loginizer-wordpress-plugin-xss-vulnerability.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.dewhurstsecurity.com/2018/05/22/loginizer-wordpress-plugin-xss-vulnerability.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://blog.dewhurstsecurity.com/2018/05/22/loginizer-wordpress-plugin-xss-vulnerability.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>

    </article>

</main>


    <footer class="site-footer">
        <div class="inner">
            <section class="copyright">All content copyright <a href="https://dewhurstsecurity.com">Dewhurst Security</a> &copy;  &bull; All rights reserved.</section>
        </div>
    </footer>


    <script type="text/javascript" src="/assets/js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-3292649-12', 'auto');
      ga('send', 'pageview');
    </script>

</body>
</html>
