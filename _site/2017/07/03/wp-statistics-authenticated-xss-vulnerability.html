<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title> Authenticated XSS Vulnerability in WP Statistics </title>
    <meta name="description" content="A few days ago the awesome folks over at Sucuri found a SQL Injection vulnerability in the popular WP Statistics WordPress Plugin, currently installed on ove...">

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />
    <!-- This is for syntax highlight -->
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css">
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-60x60.png" />
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://dewhurstsecurity.com/img/favicomatic/img/favicomatic/apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-152x152.png" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-196x196.png" sizes="196x196" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-32x32.png" sizes="32x32" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-16x16.png" sizes="16x16" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-128.png" sizes="128x128" />
	<meta name="application-name" content="&nbsp;"/>
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="https://dewhurstsecurity.com/img/favicomatic/mstile-144x144.png" />
	<meta name="msapplication-square70x70logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-70x70.png" />
	<meta name="msapplication-square150x150logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-150x150.png" />
	<meta name="msapplication-wide310x150logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-310x150.png" />
	<meta name="msapplication-square310x310logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-310x310.png" />

</head>
<body class="home-template">


    <main class="content" role="main">

    <article class="post">
        <header class="post-header">
            <a id="blog-logo" href="http://blog.dewhurstsecurity.com">
                
                    <span class="blog-title">Dewhurst Security Blog</span>
                
            </a>
        </header>

        <span class="post-meta">
        	<time datetime="2017-07-03">03 Jul 2017</time>
        	
        		on
	        	
	        
       	</span>

        <h1 class="post-title">Authenticated XSS Vulnerability in WP Statistics</h1>

        <section class="post-content">
            <h3 id="introduction">Introduction</h3>

<p>A few days ago the awesome folks over at Sucuri found a <a href="https://blog.sucuri.net/2017/06/sql-injection-vulnerability-wp-statistics.html">SQL Injection vulnerability in the popular WP Statistics WordPress Plugin</a>, currently installed on over 300,000 websites. We wanted to check our  existing toolsets would have detected the vulnerability so that we could ensure that Dewhurst Security clients were not affected by similar issues. During this process we identified the Authenticated Reflected Cross-Site Scripting (XSS) vulnerability we discuss below. This vulnerability was responsibly disclosed to the vendor who patched the issue and released a new version in the same day.</p>

<h3 id="description">Description</h3>

<p>Version 12.0.8.1 and below of the WP Statistics WordPress Plugin was found to be vulnerable to Authenticated Reflected Cross-Site Scripting (XSS). The ‘ip’ GET parameter on the ‘wps_visitors_page’ page is output to a page without first being validated, sanitised or output encoded. This leads to Authenticated Reflected Cross-Site Scripting (XSS), which could allow attackers to compromise a WordPress application by tricking an authenticated administrator user into clicking on a specially crafted link.</p>

<p>Please note that other potential instances of Authenticated XSS were identified, however, were protected by Cross-Site Request Forgery (CSRF) nonces.</p>

<p>This issue was patched within hours by the vendor in version 12.0.9.</p>

<h3 id="affected-software">Affected Software</h3>

<p>WP Statistics &lt;= 12.0.8.1 - <a href="https://wordpress.org/plugins/wp-statistics/">https://wordpress.org/plugins/wp-statistics/</a></p>

<h3 id="technical-description">Technical Description:</h3>

<p>Source: On line 28 of the <code class="highlighter-rouge">includes/log/last-visitor.php</code> file, the <code class="highlighter-rouge">$_GET['ip']</code> is placed within the <code class="highlighter-rouge">$_get</code> variable.</p>

<p>Sink: On line 74 of the <code class="highlighter-rouge">includes/log/last-visitor.php</code> file, the <code class="highlighter-rouge">$_get</code> variable is output in the PHP <code class="highlighter-rouge">echo()</code> function.</p>

<h3 id="proof-of-concept-poc">Proof of Concept (PoC):</h3>

<p>Click on the following link in the Firefox browser:
<code class="highlighter-rouge">http://mywordpress.com/wp-admin/admin.php?page=wps_visitors_page&amp;ip=%27%3E%3Cimg+src%3Dx+onerror%3Dalert%281%29%3E%3C%22</code></p>

<p>A fully weaponised XSS exploit was created that used the WordPress Theme Editor to insert a PHP backdoor into a WordPress site. The weaponised XSS payload has not been supplied with this advisory, however, it is trivial to create.</p>

<h3 id="remediation">Remediation</h3>

<p>Vendor: Pass the <code class="highlighter-rouge">$_get</code> variable through WordPress’ <code class="highlighter-rouge">esc_attr()</code> function. For example: <code class="highlighter-rouge">$_get = esc_attr($_get);</code></p>

<p>Users: Update to version 12.0.9, which fixes the vulnerability.</p>

<h3 id="timeline">Timeline:</h3>

<p>03/07/2017 09:00: Issue discovered by Ryan Dewhurst (Dewhurst Security).
03/07/2017 12:50: Contacted vendor via contact form on website https://toolstack.com/contact
03/07/2017 13:07: Contacted vendor via contact form on website https://wp-statistics.com/contact/
03/07/2017 13:37: Reply from vendor.
03/07/2017 13:41: Advisory with full details sent.
03/07/2017 14:16: Vendor replies thanking for reporting.
03/07/2017 18:00: Advisory shared with a trusted source.
03/07/2017 18:54: Vendor advises that the vulnerability has been patched on Github.
03/07/2017 20:28: Advisory released.</p>

<h3 id="references">References:</h3>

<p>https://developer.wordpress.org/reference/functions/esc_attr/
https://www.wordfence.com/learn/how-to-prevent-cross-site-scripting-attacks/
https://github.com/wp-statistics/wp-statistics/commit/82d06cd069fd9ce0a5d2fedaf1885423d67a1c25
https://blog.sucuri.net/2017/06/sql-injection-vulnerability-wp-statistics.html
https://wpvulndb.com/vulnerabilities/8855</p>

        </section>

        

        <footer class="post-footer">
            <section class="hire-me">
              <h4><a href="https://dewhurstsecurity.com/" onClick="_gaq.push(['_trackEvent', 'External Link', 'Dewhurst Security Link', 'Hire Us – Words']);">Hire Us</a></h4>
            </section>

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Authenticated XSS Vulnerability in WP Statistics&amp;url=http://blog.dewhurstsecurity.com/2017/07/03/wp-statistics-authenticated-xss-vulnerability.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.dewhurstsecurity.com/2017/07/03/wp-statistics-authenticated-xss-vulnerability.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://blog.dewhurstsecurity.com/2017/07/03/wp-statistics-authenticated-xss-vulnerability.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>

    </article>

</main>


    <footer class="site-footer">
        <div class="inner">
            <section class="copyright">All content copyright <a href="https://dewhurstsecurity.com">Dewhurst Security</a> &copy;  &bull; All rights reserved.</section>
        </div>
    </footer>


    <script type="text/javascript" src="/assets/js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-3292649-12', 'auto');
      ga('send', 'pageview');
    </script>

</body>
</html>
