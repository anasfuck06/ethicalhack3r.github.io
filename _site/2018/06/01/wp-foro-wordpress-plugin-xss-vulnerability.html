<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title> Security Vulnerability in wpForo Forum WordPress Plugin </title>
    <meta name="description" content="Version 1.4.11, and below, of the wpForo Forum WordPress Plugin were found to be vulnerable to Reflected Cross-Site Scripting (XSS). The vulnerability was du...">

    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic|Open+Sans:700,400" />
    <!-- This is for syntax highlight -->
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css">
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-60x60.png" />
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://dewhurstsecurity.com/img/favicomatic/img/favicomatic/apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://dewhurstsecurity.com/img/favicomatic/apple-touch-icon-152x152.png" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-196x196.png" sizes="196x196" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-32x32.png" sizes="32x32" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-16x16.png" sizes="16x16" />
	<link rel="icon" type="image/png" href="https://dewhurstsecurity.com/img/favicomatic/favicon-128.png" sizes="128x128" />
	<meta name="application-name" content="&nbsp;"/>
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="https://dewhurstsecurity.com/img/favicomatic/mstile-144x144.png" />
	<meta name="msapplication-square70x70logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-70x70.png" />
	<meta name="msapplication-square150x150logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-150x150.png" />
	<meta name="msapplication-wide310x150logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-310x150.png" />
	<meta name="msapplication-square310x310logo" content="https://dewhurstsecurity.com/img/favicomatic/mstile-310x310.png" />

</head>
<body class="home-template">


    <main class="content" role="main">

    <article class="post">
        <header class="post-header">
            <a id="blog-logo" href="https://blog.dewhurstsecurity.com">
                
                    <span class="blog-title">Dewhurst Security Blog</span>
                
            </a>
        </header>

        <span class="post-meta">
        	<time datetime="2018-06-01">01 Jun 2018</time>
        	
        		on
	        	
	        
       	</span>

        <h1 class="post-title">Security Vulnerability in wpForo Forum WordPress Plugin</h1>

        <section class="post-content">
            <h3 id="introduction">Introduction</h3>

<p>According to the wpForo Forum WordPress Plugin page: “wpForo Forums is the best WordPress forum plugin. Full-fledged yet easy and light forum solution for your WordPress website. Comes with modern and responsive forum layouts and styles. This WordPress forum plugin brings everything you need to run an efficient and professional community. Powerful and beautiful forum with unique features.”</p>

<p>According to WordPress, at the time of writing the Plugin had <code class="highlighter-rouge">10,000+</code> active installations.</p>

<p>This issue was patched within hours by the vendor in version 1.4.12. CVE assigned as CVE-2018-11709.</p>

<h3 id="description">Description</h3>

<p>Version 1.4.11, and below, of the wpForo Forum WordPress Plugin were found to be vulnerable to Reflected Cross-Site Scripting (XSS). The vulnerability was due to the Plugin using the <code class="highlighter-rouge">$_SERVER['REQUEST_URI']</code> PHP variable to create a URL string that was later output within HTML without any output encoding.</p>

<h3 id="risk">Risk</h3>

<p>To successfully exploit this vulnerability, an attacker would need to entice a user into clicking on a specially crafted link. The user would need to be using the Internet Explorer (IE) web browser, with the, enabled by default, XSS filter disabled, or the attacker would need to use a valid IE XSS filter bypass payload.</p>

<h3 id="affected-software">Affected Software</h3>

<p>wpForo Forum &lt;= 1.4.11 - <a href="https://wordpress.org/plugins/wpforo/">https://wordpress.org/plugins/wpforo/</a></p>

<h3 id="technical-description">Technical Description</h3>

<p>The <code class="highlighter-rouge">wpforo_get_request_uri()</code> function defined in the <code class="highlighter-rouge">wpf-includes/functions.php</code> file uses the <code class="highlighter-rouge">$_SERVER['REQUEST_URI']</code> variable to construct a URL, without any validation or output encoding. The full function code is shown below:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function wpforo_get_request_uri($with_port = FALSE, $get_referer_when_ajax = TRUE){
	if( $get_referer_when_ajax &amp;&amp; wpforo_is_ajax() ){
		if( isset($_SERVER['HTTP_REFERER']) ){ return $_SERVER['HTTP_REFERER']; }
	}
	$s = is_ssl() ? 's' : '';
    $sp = strtolower($_SERVER["SERVER_PROTOCOL"]);
    $protocol = substr($sp, 0, strpos($sp, "/")) . $s;
    $port = ($_SERVER["SERVER_PORT"] == "80") ? "" : (":".$_SERVER["SERVER_PORT"]);
    return $protocol . "://" . $_SERVER['HTTP_HOST'] . ($with_port ? $port : '') . $_SERVER['REQUEST_URI'];
}
</code></pre></div></div>

<h3 id="proof-of-concept-poc">Proof of Concept (PoC)</h3>

<p>Click on the following link while using the Internet Explorer (IE) web browser, with the XSS filter disabled:</p>

<p><a href="http://www.example.com/index.php/community/?%22%3E%3Cscript%3Ealert(/XSS/)%3C/script%3E">http://www.example.com/index.php/community/?%22%3E%3Cscript%3Ealert(/XSS/)%3C/script%3E</a></p>

<p>Alternatively, run the following cURL request and notice that the XSS payload is output within HTML, without any validation, or output encoding:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -s 'http://www.example.com/index.php/community/?"&gt;&lt;script&gt;alert(/XSS/)&lt;/script&gt;' | grep "XSS"
</code></pre></div></div>

<h3 id="remediation">Remediation</h3>

<p>Vendor: Pass the constructed URL string through WordPress’ <code class="highlighter-rouge">esc_url()</code> function before returning the string. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$url = $protocol . "://" . $_SERVER['HTTP_HOST'] . ($with_port ? $port : '') . $_SERVER['REQUEST_URI'];
return esc_url($url);
</code></pre></div></div>

<p>Users: Update to version 1.4.12, which fixes the vulnerability.</p>

<h3 id="timeline">Timeline</h3>

<ul>
  <li>31/05/2018 10:00: Issue discovered by Ryan (Dewhurst Security).</li>
  <li>31/05/2018 11:28: Sent vendor details via email.</li>
  <li>31/05/2018 11:33: Vendor replies stating they will release a patched version very soon.</li>
  <li>31/05/2018 20:49: Receive email from vendor stating new patched version released.</li>
  <li>01/06/2018 12:15: Advisory publicly released.</li>
</ul>

<h3 id="references">References</h3>

<ul>
  <li><a href="https://codex.wordpress.org/Function_Reference/esc_url">https://codex.wordpress.org/Function_Reference/esc_url</a></li>
  <li><a href="https://www.wordfence.com/learn/how-to-prevent-cross-site-scripting-attacks/">https://www.wordfence.com/learn/how-to-prevent-cross-site-scripting-attacks/</a></li>
  <li><a href="https://wpforo.com/">https://wpforo.com/</a></li>
  <li><a href="https://wpvulndb.com/vulnerabilities/9090">https://wpvulndb.com/vulnerabilities/9090</a></li>
  <li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11709">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11709</a></li>
</ul>

        </section>

        

        <footer class="post-footer">
            <section class="hire-me">
              <h4><a href="https://dewhurstsecurity.com/" onClick="_gaq.push(['_trackEvent', 'External Link', 'Dewhurst Security Link', 'Hire Us – Words']);">Hire Us</a></h4>
            </section>

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Security Vulnerability in wpForo Forum WordPress Plugin&amp;url=https://blog.dewhurstsecurity.com/2018/06/01/wp-foro-wordpress-plugin-xss-vulnerability.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.dewhurstsecurity.com/2018/06/01/wp-foro-wordpress-plugin-xss-vulnerability.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://blog.dewhurstsecurity.com/2018/06/01/wp-foro-wordpress-plugin-xss-vulnerability.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>

    </article>

</main>


    <footer class="site-footer">
        <div class="inner">
            <section class="copyright">All content copyright <a href="https://dewhurstsecurity.com">Dewhurst Security</a> &copy;  &bull; All rights reserved.</section>
        </div>
    </footer>


    <script type="text/javascript" src="/assets/js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-3292649-12', 'auto');
      ga('send', 'pageview');
    </script>

</body>
</html>
